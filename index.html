<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NzzsGuessor</title>
    <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">
  </head>
  <body>
    
    <div class="number-guesser-section">
      <h1>!zzsGuesser!</h1>
      <h2>Number Guessing Game (1-1000)</h2>
      <div class="game-container">
        <p id="gameStatus">Guess a number between 1 and 1000!</p>
        <p id="conditionsStatus" class="conditions-status"></p>
        <div class="input-group">
          <input type="number" id="guessInput" min="1" max="1000" placeholder="Enter your guess">
          <button id="submitGuess">Guess</button>
          <button id="applyConditions" aria-pressed="false" title="Toggle penalty rules for guesses that violate established higher/lower bounds">Apply Conditions: Off</button>
          <button id="newGame">New Game</button>
        </div>
        <div id="guessHistory" class="guess-history"></div>
        <div class="game-stats">
          <p>Guesses: <span id="guessCount">0</span></p>
        </div>
        <div class="game-history-section">
          <h3>Game History</h3>
          <div class="history-buttons">
            <button id="viewHistory">View All Games</button>
            <button id="clearDatabase">Clear Database</button>
          </div>
          <div id="historyDisplay" class="history-display"></div>
        </div>
      </div>
    </div>
<style>
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle at top, #1e3c72, #2a5298 40%, #000 100%);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: #f5f5f5;
  }

  h1 {
    text-align: center;
    margin: 20px 0 10px;
    font-family: "Alfa Slab One", system-ui, sans-serif;
    letter-spacing: 2px;
    font-size: 40px;
    color: #ffeb3b;
    text-shadow: 0 0 10px rgba(255, 235, 59, 0.7), 0 0 25px rgba(255, 193, 7, 0.6);
    animation: titleGlow 2.5s ease-in-out infinite alternate;
  }

/* Number Guessing Game Styles */
.number-guesser-section {
    max-width: 600px;
    margin: 20px auto 40px;
    padding: 20px;
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.55));
    border-radius: 18px;
    box-shadow: 0 14px 35px rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.14);
    animation: cardFloat 6s ease-in-out infinite;
}

.number-guesser-section h2 {
    text-align: center;
    color: #ffffff;
    margin-bottom: 20px;
    font-weight: 600;
}

.game-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#gameStatus {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px;
    background-color: rgba(227, 242, 253, 0.9);
    color: #0d47a1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

#gameStatus.success {
    background-color: #c8e6c9;
    color: #1b5e20;
    animation: pulseWin 0.8s ease-out 1;
}

#gameStatus.error {
    background-color: #ffcdd2;
    color: #c62828;
    animation: shakeError 0.4s ease-in-out 1;
}

#gameStatus.hint {
    background-color: #fff3e0;
    color: #e65100;
}

.conditions-status {
    text-align: center;
    font-size: 12px;
    color: #e0e0e0;
    margin: -6px 0 4px 0;
    font-style: oblique;
}

.conditions-status strong {
    color: #333;
}

.input-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

#guessInput {
    flex: 1;
    min-width: 150px;
    padding: 10px;
    font-size: 16px;
    border: 2px solid rgba(255, 255, 255, 0.35);
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.35);
    color: #ffffff;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
}

#guessInput:focus {
    outline: none;
    border-color: #4caf50;
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.4);
}

#submitGuess,
#applyConditions,
#newGame {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 999px;
    cursor: pointer;
    transition: background-color 0.25s ease, transform 0.15s ease, box-shadow 0.2s ease;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.35);
}

#submitGuess {
    background-color: #4caf50;
    color: white;
}

#submitGuess:hover:not(:disabled) {
    background-color: #45a049;
    transform: translateY(-1px);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
}

#submitGuess:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

#applyConditions {
    background-color: #6a1b9a;
    color: white;
}

#applyConditions:hover {
    background-color: #4a148c;
    transform: translateY(-1px);
    box-shadow: 0 8px 20px rgba(106, 27, 154, 0.6);
}

#applyConditions.active {
    background-color: #2e7d32;
}

#applyConditions.active:hover {
    background-color: #1b5e20;
}

#newGame {
    background-color: #2196f3;
    color: white;
}

#newGame:hover {
    background-color: #0b7dda;
    transform: translateY(-1px);
    box-shadow: 0 8px 20px rgba(33, 150, 243, 0.6);
}

.guess-history {
    padding: 10px;
    background-color: rgba(255, 255, 255, 0.04);
    border-radius: 8px;
    min-height: 50px;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.guess-history ul {
    margin: 10px 0 0 0;
    padding-left: 20px;
}

.guess-history li {
    margin: 5px 0;
}

.active-guess-list {
    max-height: 250px;
    overflow-y: auto;
    list-style-type: decimal;
}

.active-guess-list li {
    margin: 8px 0;
    padding: 5px;
    background-color: rgba(255, 255, 255, 0.06);
    border-radius: 4px;
}

.game-stats {
    text-align: center;
    font-size: 16px;
    font-weight: bold;
    color: #f5f5f5;
}

.game-history-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px solid #ddd;
}

.game-history-section h3 {
    margin-bottom: 10px;
    color: #ffffff;
}

.history-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

#viewHistory,
#clearDatabase {
    padding: 8px 16px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

#viewHistory {
    background-color: #ff9800;
    color: white;
}

#viewHistory:hover {
    background-color: #f57c00;
}

#clearDatabase {
    background-color: #f44336;
    color: white;
}

#clearDatabase:hover {
    background-color: #d32f2f;
}

.history-display {
    margin-top: 15px;
}

.history-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 15px;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.45);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    color: #f5f5f5;
}

.history-stats p {
    margin: 5px 0;
}

.history-table {
    width: 100%;
    border-collapse: collapse;
    background-color: rgba(0, 0, 0, 0.55);
    border-radius: 8px;
    overflow: hidden;
    color: #e0e0e0;
}

.history-table thead {
    background-color: rgba(33, 150, 243, 0.9);
    color: #ffffff;
}

.history-table th,
.history-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.12);
}

.history-table tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.08);
}

.history-table tbody tr.selected {
    background-color: rgba(227, 242, 253, 0.18) !important;
    font-weight: bold;
}

.history-table tbody tr:last-child td {
    border-bottom: none;
}

.selected-game-guesses {
    margin-top: 15px;
    padding: 15px;
    background-color: rgba(0, 0, 0, 0.55);
    border-radius: 10px;
    border: 1px solid rgba(33, 150, 243, 0.6);
    color: #f5f5f5;
}

.selected-game-header {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.18);
}

.selected-game-header h4 {
    margin: 0 0 10px 0;
    color: #64b5f6;
}

.selected-game-header p {
    margin: 5px 0;
    font-size: 14px;
    color: #e0e0e0;
}

.selected-game-guess-list {
    margin-top: 10px;
}

.historical-guess-list {
    max-height: 200px;
    overflow-y: auto;
    list-style-type: decimal;
    margin: 10px 0;
    padding-left: 25px;
    background-color: rgba(255, 255, 255, 0.04);
    padding: 10px 10px 10px 25px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.12);
}

.historical-guess-list li {
    margin: 8px 0;
    padding: 5px;
    background-color: rgba(255, 255, 255, 0.06);
    border-radius: 4px;
    color: #f5f5f5;
}

.more-guesses-note {
    font-size: 12px;
    color: #666;
    font-style: italic;
    margin-top: 10px;
}

/* Fun animations */
@keyframes titleGlow {
  from {
    text-shadow: 0 0 8px rgba(255, 235, 59, 0.6), 0 0 18px rgba(255, 193, 7, 0.5);
    transform: translateY(0);
  }
  to {
    text-shadow: 0 0 16px rgba(255, 235, 59, 0.9), 0 0 30px rgba(255, 193, 7, 0.9);
    transform: translateY(-2px);
  }
}

@keyframes cardFloat {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-6px);
  }
}

@keyframes pulseWin {
  0% {
    transform: scale(1);
  }
  40% {
    transform: scale(1.04);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes shakeError {
  0% { transform: translateX(0); }
  20% { transform: translateX(-5px); }
  40% { transform: translateX(5px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
  100% { transform: translateX(0); }
}
</style>


<script>
      // Number Guessing Game with IndexedDB
class NumberGuessingGame {
  constructor() {
    this.targetNumber = null;
    this.guessCount = 0;
    this.guessHistory = [];
    this.conditionsEnabled = false;
    this.minAllowed = 1;
    this.maxAllowed = 1000;
    this.historyVisible = false;
    this.db = null;
    this.init();
  }

  async init() {
    await this.initDB();
    this.setupEventListeners();
    this.startNewGame();
  }

  // Initialize IndexedDB
  initDB() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open('NumberGuessingGameDB', 1);

      request.onerror = () => {
        console.error('IndexedDB error:', request.error);
        reject(request.error);
      };

      request.onsuccess = () => {
        this.db = request.result;
        console.log('IndexedDB initialized');
        resolve();
      };

      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains('games')) {
          const objectStore = db.createObjectStore('games', {
            keyPath: 'id',
            autoIncrement: true
          });
          objectStore.createIndex('timestamp', 'timestamp', { unique: false });
          objectStore.createIndex('guessCount', 'guessCount', { unique: false });
        }
      };
    });
  }

  // Start a new game
  startNewGame() {
    this.targetNumber = Math.floor(Math.random() * 1000) + 1;
    this.guessCount = 0;
    this.guessHistory = [];
    this.minAllowed = 1;
    this.maxAllowed = 1000;
    this.updateUI();
    this.updateConditionsStatus();
    document.getElementById('guessInput').value = '';
    document.getElementById('guessInput').disabled = false;
    document.getElementById('submitGuess').disabled = false;
    console.log('New game started. Target number:', this.targetNumber);
  }

  updateConditionsStatus() {
    const el = document.getElementById('conditionsStatus');
    const input = document.getElementById('guessInput');
    if (!el || !input) return;

    if (!this.conditionsEnabled) {
      el.innerHTML = '<strong>Conditions:</strong> Off';
      input.min = '1';
      input.max = '1000';
      return;
    }

    el.innerHTML = `<strong>Conditions:</strong> On | <strong>Allowed range:</strong> ${this.minAllowed}â€“${this.maxAllowed}`;
    input.min = String(this.minAllowed);
    input.max = String(this.maxAllowed);
  }

  setConditionsEnabled(enabled) {
    this.conditionsEnabled = enabled;
    const btn = document.getElementById('applyConditions');
    if (!btn) return;
    btn.classList.toggle('active', enabled);
    btn.setAttribute('aria-pressed', enabled ? 'true' : 'false');
    btn.textContent = enabled ? 'Apply Conditions: On' : 'Apply Conditions: Off';
    this.updateConditionsStatus();
  }

  // Handle guess submission
  handleGuess() {
    const input = document.getElementById('guessInput');
    const guess = parseInt(input.value);

    if (isNaN(guess) || guess < 1 || guess > 1000) {
      this.updateStatus('Please enter a valid number between 1 and 1000!', 'error');
      return;
    }

    // Apply "conditions" rule: if guess violates established bounds (from prior hints),
    // apply a penalty guess and prompt the user to guess again without advancing state.
    if (this.conditionsEnabled && (guess < this.minAllowed || guess > this.maxAllowed)) {
      // Record the invalid attempt AND an additional penalty entry.
      const attemptCount = this.guessHistory.length + 1;
      this.guessHistory.push({
        guess,
        result: `Out of bounds (allowed ${this.minAllowed}â€“${this.maxAllowed}).`,
        count: attemptCount,
        isViolation: true
      });

      const penaltyCount = attemptCount + 1;
      const message = "You've Been Penalized. Guess Again.";
      this.guessHistory.push({
        guess,
        result: message,
        count: penaltyCount,
        isPenalty: true
      });

      this.guessCount = penaltyCount;
      document.getElementById('guessCount').textContent = String(penaltyCount);

      this.updateStatus(message, 'error');
      this.updateGuessHistory();
      this.updateConditionsStatus();

      input.value = '';
      input.focus();
      return;
    }

    // Check if this number has already been guessed (ignore penalty attempts)
    const alreadyGuessed = this.guessHistory.some(item => item.guess === guess && !item.isPenalty && !item.isViolation);
    if (alreadyGuessed) {
      this.updateStatus(`You've already guessed ${guess}! Try a different number.`, 'error');
      input.value = '';
      input.focus();
      return;
    }

    const nextCount = this.guessHistory.length + 1;
    this.guessCount = nextCount;
    // Update guess count display
    document.getElementById('guessCount').textContent = String(nextCount);
    
    let message = '';
    let statusClass = '';

    if (guess === this.targetNumber) {
      message = `ðŸŽ‰ Congratulations! You guessed it in ${nextCount} ${nextCount === 1 ? 'guess' : 'guesses'}!`;
      statusClass = 'success';
      input.disabled = true;
      document.getElementById('submitGuess').disabled = true;
    } else if (guess < this.targetNumber) {
      message = `Higher! (Guess #${nextCount})`;
      statusClass = 'hint';
      // Establish/strengthen the known lower bound for subsequent guesses
      this.minAllowed = Math.max(this.minAllowed, guess + 1);
    } else {
      message = `Lower! (Guess #${nextCount})`;
      statusClass = 'hint';
      // Establish/strengthen the known upper bound for subsequent guesses
      this.maxAllowed = Math.min(this.maxAllowed, guess - 1);
    }

    // Add guess to history BEFORE saving (so final guess is included)
    this.guessHistory.push({ guess, result: message, count: nextCount });
    this.updateStatus(message, statusClass);
    this.updateGuessHistory();
    this.updateConditionsStatus();
    
    // Save game after adding the final guess to history
    if (guess === this.targetNumber) {
      this.saveGame();
    }
    
    input.value = '';
    input.focus();
  }

  // Update status message
  updateStatus(message, className = '') {
    const statusEl = document.getElementById('gameStatus');
    statusEl.textContent = message;
    statusEl.className = className;
  }

  // Update guess count display
  updateUI() {
    document.getElementById('guessCount').textContent = this.guessCount;
    this.updateStatus('Guess a number between 1 and 1000!');
    this.updateGuessHistory();
  }

  // Update guess history display (shows all guesses during active session)
  updateGuessHistory() {
    const historyEl = document.getElementById('guessHistory');
    if (this.guessHistory.length === 0) {
      historyEl.innerHTML = '';
      return;
    }

    // Show all guesses during active session, most recent first
    const allGuesses = [...this.guessHistory].reverse();
    historyEl.innerHTML = '<strong>All Guesses (Active Game):</strong><ul class="active-guess-list">' +
      allGuesses.map(item => {
        const flags = [
          item.isPenalty ? 'Penalty' : null,
          item.isViolation ? 'Violation' : null
        ].filter(Boolean);
        const flagLabel = flags.length ? ` (${flags.join(', ')})` : '';
        return `<li>Guess #${item.count}: ${item.guess}${flagLabel} - ${item.result.replace(/\(Guess #\d+\)/g, '').trim()}</li>`;
      }).join('') + '</ul>';
  }

  // Save game to IndexedDB
  saveGame() {
    if (!this.db) {
      console.error('Database not initialized');
      return;
    }

    // Persist penalties too (flagged via isPenalty)
    const penaltyCount = this.guessHistory.filter(item => !!item.isPenalty).length;
    // Make sure the saved guessCount reflects total attempts (including penalties)
    const totalGuessCount = this.guessHistory.length;
    // Create a deep copy of guessHistory to ensure all data is saved
    const guessHistoryCopy = this.guessHistory.map(item => ({
      guess: item.guess,
      result: item.result,
      count: item.count,
      isPenalty: !!item.isPenalty,
      isViolation: !!item.isViolation
    }));

    console.log('Saving game - guessCount:', this.guessCount);
    console.log('Saving game - guessHistory length:', this.guessHistory.length);
    console.log('Saving game - guessHistory:', this.guessHistory);
    console.log('Saving game - guessHistoryCopy length:', guessHistoryCopy.length);

    const gameData = {
      targetNumber: this.targetNumber,
      guessCount: totalGuessCount,
      penaltyCount,
      timestamp: new Date().toISOString(),
      guessHistory: guessHistoryCopy
    };

    const transaction = this.db.transaction(['games'], 'readwrite');
    const objectStore = transaction.objectStore('games');
    const request = objectStore.add(gameData);

    request.onsuccess = () => {
      console.log('Game saved to IndexedDB with', guessHistoryCopy.length, 'guesses');
    };

    request.onerror = () => {
      console.error('Error saving game:', request.error);
    };
  }

  // Load and display game history
  async loadGameHistory() {
    if (!this.db) {
      console.error('Database not initialized');
      return;
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['games'], 'readonly');
      const objectStore = transaction.objectStore('games');
      const request = objectStore.getAll();

      request.onsuccess = () => {
        const games = request.result;
        this.displayHistory(games);
        resolve(games);
      };

      request.onerror = () => {
        console.error('Error loading history:', request.error);
        reject(request.error);
      };
    });
  }

  // Display game history
  displayHistory(games) {
    const historyDisplay = document.getElementById('historyDisplay');
    
    if (games.length === 0) {
      historyDisplay.innerHTML = '<p>No games played yet.</p>';
      this.historyVisible = true;
      const viewBtn = document.getElementById('viewHistory');
      if (viewBtn) viewBtn.textContent = 'Hide All Games';
      return;
    }

    // Sort by timestamp (newest first)
    games.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

    const historyHTML = `
      <div class="history-stats">
        <p><strong>Total Games:</strong> ${games.length}</p>
        <p><strong>Average Guesses:</strong> ${(games.reduce((sum, g) => sum + g.guessCount, 0) / games.length).toFixed(2)}</p>
        <p><strong>Best Score:</strong> ${Math.min(...games.map(g => g.guessCount))} guesses</p>
      </div>
      <table class="history-table">
        <thead>
          <tr>
            <th>Game #</th>
            <th>Target</th>
            <th>Guesses</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          ${games.map((game, index) => `
            <tr class="history-row" data-game-id="${game.id || index}" data-game-index="${index}">
              <td>${games.length - index}</td>
              <td>${game.targetNumber}</td>
              <td>${game.guessCount}</td>
              <td>${new Date(game.timestamp).toLocaleString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      <div id="selectedGameGuesses" class="selected-game-guesses"></div>
    `;

    historyDisplay.innerHTML = historyHTML;
    this.historyVisible = true;
    const viewBtn = document.getElementById('viewHistory');
    if (viewBtn) viewBtn.textContent = 'Hide All Games';
    
    // Add click listeners to table rows
    const rows = historyDisplay.querySelectorAll('.history-row');
    rows.forEach(row => {
      row.style.cursor = 'pointer';
      row.addEventListener('click', () => {
        const gameIndex = parseInt(row.dataset.gameIndex);
        this.displayGameGuesses(games[gameIndex]);
        // Highlight selected row
        rows.forEach(r => r.classList.remove('selected'));
        row.classList.add('selected');
      });
    });
  }

  // Display guesses for a selected historical game
  displayGameGuesses(game) {
    const selectedGameGuesses = document.getElementById('selectedGameGuesses');
    
    if (!game) {
      selectedGameGuesses.innerHTML = '<p>No game data available.</p>';
      return;
    }

    if (!game.guessHistory || game.guessHistory.length === 0) {
      selectedGameGuesses.innerHTML = '<p>No guess history available for this game.</p>';
      return;
    }

    // Show all guesses in chronological order (oldest first, newest last)
    // Create a fresh array to ensure we have all items
    const allGuesses = game.guessHistory.map(item => ({
      guess: item.guess,
      result: item.result,
      count: item.count,
      isPenalty: !!item.isPenalty,
      isViolation: !!item.isViolation
    }));
    
    // Debug: Log to verify all guesses are present
    console.log('Displaying game - guessCount:', game.guessCount);
    console.log('Displaying game - guessHistory length:', game.guessHistory.length);
    console.log('Displaying game - allGuesses length:', allGuesses.length);
    console.log('Displaying game - allGuesses:', allGuesses);
    
    // Sort by count to ensure correct order (in case they're not in order)
    allGuesses.sort((a, b) => a.count - b.count);
    
    const guessesHTML = `
      <div class="selected-game-header">
        <h4>Game Details</h4>
        <p><strong>Target Number:</strong> ${game.targetNumber} | <strong>Total Guesses:</strong> ${game.guessCount} | <strong>Penalties:</strong> ${game.penaltyCount || 0} | <strong>Date:</strong> ${new Date(game.timestamp).toLocaleString()}</p>
        <p><strong>Guesses in History:</strong> ${game.guessHistory.length} | <strong>Displayed:</strong> ${allGuesses.length}</p>
      </div>
      <div class="selected-game-guess-list">
        <strong>All Guesses:</strong>
        <ul class="historical-guess-list">
          ${allGuesses.map(item => {
            const flags = [
              item.isPenalty ? 'Penalty' : null,
              item.isViolation ? 'Violation' : null
            ].filter(Boolean);
            const flagLabel = flags.length ? ` (${flags.join(', ')})` : '';
            return `<li>Guess #${item.count}: ${item.guess}${flagLabel} - ${item.result.replace(/\(Guess #\d+\)/g, '').trim()}</li>`;
          }).join('')}
        </ul>
      </div>
    `;

    selectedGameGuesses.innerHTML = guessesHTML;
  }

  // Clear all games from IndexedDB
  clearDatabase() {
    if (!this.db) {
      console.error('Database not initialized');
      return;
    }

    const confirmed = confirm('Are you sure you want to delete all game history? This action cannot be undone.');
    
    if (!confirmed) {
      return;
    }

    const transaction = this.db.transaction(['games'], 'readwrite');
    const objectStore = transaction.objectStore('games');
    const request = objectStore.clear();

    request.onsuccess = () => {
      console.log('Database cleared');
      document.getElementById('historyDisplay').innerHTML = '<p>No games played yet.</p>';
      alert('All game history has been deleted.');
    };

    request.onerror = () => {
      console.error('Error clearing database:', request.error);
      alert('Error clearing database. Please try again.');
    };
  }

  // Setup event listeners
  setupEventListeners() {
    document.getElementById('submitGuess').addEventListener('click', () => {
      this.handleGuess();
    });

    document.getElementById('guessInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.handleGuess();
      }
    });

    document.getElementById('newGame').addEventListener('click', () => {
      this.startNewGame();
    });

    document.getElementById('applyConditions').addEventListener('click', () => {
      this.setConditionsEnabled(!this.conditionsEnabled);
      // Keep this subtle; gameStatus will update on next guess, but give immediate feedback too.
      this.updateStatus(
        this.conditionsEnabled
          ? 'Conditions enabled: invalid guesses will be penalized.'
          : 'Conditions disabled.',
        'hint'
      );
      document.getElementById('guessInput').focus();
    });

    document.getElementById('viewHistory').addEventListener('click', () => {
      const historyDisplay = document.getElementById('historyDisplay');
      if (this.historyVisible) {
        // Hide history
        historyDisplay.innerHTML = '';
        this.historyVisible = false;
        document.getElementById('viewHistory').textContent = 'View All Games';
      } else {
        // Show history
        this.loadGameHistory();
      }
    });

    document.getElementById('clearDatabase').addEventListener('click', () => {
      this.clearDatabase();
    });
  }
}

// Initialize the game when DOM is loaded
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    new NumberGuessingGame();
  });
} else {
  new NumberGuessingGame();
}
    </script>
  </body>
</html>
